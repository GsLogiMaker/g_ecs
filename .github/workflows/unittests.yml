
name: Run Unit Tests

on:
  push:
    branches: [ "dev" ]
  pull_request:
    branches: [ "dev" ]
  workflow_dispatch:

env:
  CARGO_TERM_COLOR: always

jobs:
  build:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4
    - name: Initialize submodules
      run: git submodule update --init --recursive

    - uses: actions/checkout@v4
    - name: Build Glecs
      run: |
        cargo build --verbose \
          --manifest-path \./addons/glecs/rust/glecs/Cargo.toml \
          --features compile_bindings \
          --target-dir ./addons/glecs/bin
      
    - name: Setup Godot
      uses: Vitorgus/Setup-Godot@v1.1.1
      with:
        # Godot version to download
        godot-version: 4.2.0
        # If set to true, will download de mono version of Godot
        mono: false # optional
        # If set to false, will skip the default export templates download
        download-templates: false # optional, default is true
          
    - name: Run tests
      run:
        godot --headless -s res://addons/gut/gut_cmdln.gd -gdir="res://unittests/" -gexit